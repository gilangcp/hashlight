(function(a){a.fn.hashlight=function(d){var m=[];var t={tag:"#",pattern:function(h){return new RegExp("(^"+h+"[A-Za-z0-9-_]+| "+h+"[A-Za-z0-9-_]+)","g")},dataProvider:null,markerElement:function(h){return'<div class="hashlight-marker" id="'+h+'" ></div>'},tagElement:function(h){urltag=h.replace(t.tag,"");return"<a class='hashlight-tag' href='"+urltag+"'><span  style='color: white;border-radius: 3px;background-color : #3498db;'>"+h+"</span></a>"},autoCompleteElement:function(h){var u="<ul class='hashlight-autocomplete'>";for(i in h){if(i==0){u+="<li data-value='"+h[i]+"' class='hashlight-autocomplete-active'>"+h[i]+"</li>"}else{u+="<li data-value='"+h[i]+"'>"+h[i]+"</li>"}}u+="</ul>";return u}};for(option in d){t[option]=d[option]}var b=this.attr("id");a("body").append(t.markerElement(b+"-marker"));var k=a("#"+b+"-marker");var e=this;e.css("word-break","break-all");k.css("padding-top",e.css("padding-top"));k.css("padding-right",e.css("padding-right"));k.css("padding-left",e.css("padding-left"));k.css("padding-bottom",e.css("padding-bottom"));k.css("font-family",e.css("font-family"));k.css("font-size",e.css("font-size"));var g=0;var f=0;var j=0;var s=0;var o=e.offset().top;var n=e.offset().left;var q=e.width();var l=e.height();var c=false;var p;k.width(q);k.height(l);k.offset({top:o,left:n});function r(){o=e.offset().top;n=e.offset().left;q=e.width();l=e.height();if(g!=o||f!=n||j!=q||s!=l){k.width(q);k.height(l);k.offset({top:o,left:n});a(".hashlight-autocomplete").offset({top:o+l+5,left:n});a(".hashlight-autocomplete").width(q+4);g=o;f=n;j=q;s=l}requestAnimationFrame(r)}requestAnimationFrame(r);this.on("scroll",function(){k.scrollTop(e.scrollTop())});this.bind("input propertychange",function(x){var y=e.val().replace(/\n/g,"<br/>");var v=y.slice(0);y=y.split(" ").join("&nbsp;<wbr>");var h=v.match(t.pattern(t.tag));if(h!=null){h.sort(function(A,z){A.length-z.length})}for(i in h){h[i]=h[i].replace(" ","");y=y.replace(new RegExp("\\"+h[i]+"\\b","g"),"#"+i+"#")}for(i in h){y=y.replace(new RegExp("#"+i+"#","g"),t.tagElement(h[i]))}k.empty().html(y);if(t.dataProvider!=null){a(".hashlight-autocomplete").remove();c=false;p=a(h).not(m).get();if(p.length>0){var u=t.dataProvider(p);var w=t.autoCompleteElement(u);a("body").append(w);a(".hashlight-autocomplete").offset({top:o+l+5,left:n});a(".hashlight-autocomplete").width(q+4);c=true}m=h}});this.on("keydown",function(x){switch(x.keyCode){case 38:if(c){var w=a(".hashlight-autocomplete").find(".hashlight-autocomplete-active").prev();if(w.length>0){a(".hashlight-autocomplete-active").removeClass("hashlight-autocomplete-active");w.addClass("hashlight-autocomplete-active")}x.preventDefault()}break;case 40:if(c){var v=a(".hashlight-autocomplete").find(".hashlight-autocomplete-active").next();if(v.length>0){a(".hashlight-autocomplete-active").removeClass("hashlight-autocomplete-active");v.addClass("hashlight-autocomplete-active")}x.preventDefault()}break;case 13:if(c){var u=a(".hashlight-autocomplete-active").data("value");var h=e.val();h=h.replace(new RegExp("\\"+p[0]+"\\b"),u+" ");e.val(h);e.trigger("propertychange");a(".hashlight-autocomplete").remove();x.preventDefault()}break}});a(document).on("mouseover",".hashlight-autocomplete li",function(){a(".hashlight-autocomplete-active").removeClass("hashlight-autocomplete-active");a(this).addClass("hashlight-autocomplete-active")});a(document).on("click",".hashlight-autocomplete li",function(v){if(c){var u=a(".hashlight-autocomplete-active").data("value");var h=e.val();h=h.replace(new RegExp("\\"+p[0]+"\\b"),u+" ");e.focus();e.val(h);e.trigger("propertychange");a(".hashlight-autocomplete").remove();v.preventDefault()}});a.fn.hashlight.getTagArray=function(){var h=e.val();return h.match(t.pattern(t.tag))};a.fn.hashlight.getOptions=function(){return t}}}(jQuery));